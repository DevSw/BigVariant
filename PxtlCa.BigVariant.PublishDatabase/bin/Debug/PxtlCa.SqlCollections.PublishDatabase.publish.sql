/*
Deployment script for PxtlCa.SqlCollections.Database

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "PxtlCa.SqlCollections.Database"
:setvar DefaultFilePrefix "PxtlCa.SqlCollections.Database"
:setvar DefaultDataPath "C:\Program Files (x86)\Microsoft SQL Server\MSSQL12.MSSQLSERVER\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files (x86)\Microsoft SQL Server\MSSQL12.MSSQLSERVER\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [master];


GO

IF (DB_ID(N'$(DatabaseName)') IS NOT NULL) 
BEGIN
    ALTER DATABASE [$(DatabaseName)]
    SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
    DROP DATABASE [$(DatabaseName)];
END

GO
PRINT N'Creating $(DatabaseName)...'
GO
CREATE DATABASE [$(DatabaseName)]
    ON 
    PRIMARY(NAME = [$(DatabaseName)], FILENAME = N'$(DefaultDataPath)$(DefaultFilePrefix)_Primary.mdf')
    LOG ON (NAME = [$(DatabaseName)_log], FILENAME = N'$(DefaultLogPath)$(DefaultFilePrefix)_Primary.ldf') COLLATE SQL_Latin1_General_CP1_CI_AS
GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ANSI_NULLS ON,
                ANSI_PADDING ON,
                ANSI_WARNINGS ON,
                ARITHABORT ON,
                CONCAT_NULL_YIELDS_NULL ON,
                NUMERIC_ROUNDABORT OFF,
                QUOTED_IDENTIFIER ON,
                ANSI_NULL_DEFAULT ON,
                CURSOR_DEFAULT LOCAL,
                RECOVERY FULL,
                CURSOR_CLOSE_ON_COMMIT OFF,
                AUTO_CREATE_STATISTICS ON,
                AUTO_SHRINK OFF,
                AUTO_UPDATE_STATISTICS ON,
                RECURSIVE_TRIGGERS OFF 
            WITH ROLLBACK IMMEDIATE;
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_CLOSE OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ALLOW_SNAPSHOT_ISOLATION OFF;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET READ_COMMITTED_SNAPSHOT OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_UPDATE_STATISTICS_ASYNC OFF,
                PAGE_VERIFY NONE,
                DATE_CORRELATION_OPTIMIZATION OFF,
                DISABLE_BROKER,
                PARAMETERIZATION SIMPLE,
                SUPPLEMENTAL_LOGGING OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF IS_SRVROLEMEMBER(N'sysadmin') = 1
    BEGIN
        IF EXISTS (SELECT 1
                   FROM   [master].[dbo].[sysdatabases]
                   WHERE  [name] = N'$(DatabaseName)')
            BEGIN
                EXECUTE sp_executesql N'ALTER DATABASE [$(DatabaseName)]
    SET TRUSTWORTHY OFF,
        DB_CHAINING OFF 
    WITH ROLLBACK IMMEDIATE';
            END
    END
ELSE
    BEGIN
        PRINT N'The database settings cannot be modified. You must be a SysAdmin to apply these settings.';
    END


GO
IF IS_SRVROLEMEMBER(N'sysadmin') = 1
    BEGIN
        IF EXISTS (SELECT 1
                   FROM   [master].[dbo].[sysdatabases]
                   WHERE  [name] = N'$(DatabaseName)')
            BEGIN
                EXECUTE sp_executesql N'ALTER DATABASE [$(DatabaseName)]
    SET HONOR_BROKER_PRIORITY OFF 
    WITH ROLLBACK IMMEDIATE';
            END
    END
ELSE
    BEGIN
        PRINT N'The database settings cannot be modified. You must be a SysAdmin to apply these settings.';
    END


GO
ALTER DATABASE [$(DatabaseName)]
    SET TARGET_RECOVERY_TIME = 0 SECONDS 
    WITH ROLLBACK IMMEDIATE;


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET FILESTREAM(NON_TRANSACTED_ACCESS = OFF),
                CONTAINMENT = NONE 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_CREATE_STATISTICS ON(INCREMENTAL = OFF),
                MEMORY_OPTIMIZED_ELEVATE_TO_SNAPSHOT = OFF,
                DELAYED_DURABILITY = DISABLED 
            WITH ROLLBACK IMMEDIATE;
    END


GO
USE [$(DatabaseName)];


GO
IF fulltextserviceproperty(N'IsFulltextInstalled') = 1
    EXECUTE sp_fulltext_database 'enable';


GO
PRINT N'Creating [PxtlCa.SqlCollections.Core]...';


GO
CREATE ASSEMBLY [PxtlCa.SqlCollections.Core]
    AUTHORIZATION [dbo]
    FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300B79700570000000000000000E00022200B013000000E00000008000000000000B62C0000002000000040000000000010002000000002000004000000000000000400000000000000008000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000642C00004F000000004000000804000000000000000000000000000000000000006000000C0000002C2B00001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000BC0C000000200000000E000000020000000000000000000000000000200000602E7273726300000008040000004000000006000000100000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000001600000000000000000000000000004000004200000000000000000000000000000000982C0000000000004800000002000500CC210000600900000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000760002037D0100000402032C0A037E1300000AFE012B01177D020000042A1E027B010000042A1E027B020000042A0000133001000F00000001000011001200FE1502000002060B2B00072A00133001002500000002000011000228030000060A062C090072010000700B2B0F000228020000066F1400000A0B2B00072A000000133002005F00000003000011000228030000062C10032C0A037E1300000AFE012B01172B01160A062C0500170B2B3A03750200000214FE030C082C1D0003A5020000020D022802000006120328020000066F1500000A0B2B1000022802000006036F1500000A0B2B00072A00133001001C00000004000011000228030000062D0D0228020000066F1600000A2B01160A2B00062A133001000C00000005000011000273010000060A2B00062A133001000C00000005000011000273010000060A2B00062A133001000C00000005000011000273010000060A2B00062A13300100110000000500001100028C1900000173010000060A2B00062A00000042534A4201000100000000000C00000076322E302E35303732370000000005006C00000070030000237E0000DC0300001404000023537472696E677300000000F00700000C00000023555300FC0700001000000023475549440000000C0800005401000023426C6F6200000000000000020000015715A2010900000000FA013300160000010000001A00000003000000020000000B0000000600000016000000180000000500000001000000030000000300000001000000020000000000DE02010000000000060006028B03060099028B030600070159030F00AB03000006004A0126030600E90126030600B501260306008002260306004C02260306006502260306007D012603060036016C030600F9006C030600980126030600260204040A00D60338030A006101380306009C001F030600DE008B030600C700590306001B0159030600DD031F030A00D40138030A001803BA030A00C702BA030600FD021F03000000000100000000000100010009011000F903A60049000100010081011000E403A600590003000900210061005D0021007800600050200000000086185303630001006E20000000008608B7026800020076200000000086080D036C00020080200000000096080403700002009C2000000000C600D10236000200D02000000000C600CF03420002003C2100000000C60090004B0003006421000000009600C100750003007C210000000096000A007B000400942100000000960032007B000500AC210000000096001C008200060000000100C10200000100DA0200000100C10200000100C10200000100C10200000100C102090053030100110053030600190053030A00290053031000310053031000390053031000410053031000490053031000510053031000590053031000610053031500690053031000710053031000790053030600890053031A00990053030600A90053032000B90053030600D100BB022600B100D1023600B100CF034200B10090004B00210083003C0121008B0041012E000B0096002E0013009F002E001B00BE002E002300C7002E002B00E7002E003300E7002E003B00E7002E004300C7002E004B00ED002E005300E7002E005B00E7002E00630005012E006B002F012E0073003C01400083003C01410083003C0141008B00410143007B004A01600083003C01200193003C01400193003C01600193003C012A0031003A0047004F00020001000000BB028900000011038D00000013039100020002000300020003000500020004000700048000000100000000000000000000000000A6000000020000000000000000000000540058000000000002000000000000000000000054004C00000000000000003C4D6F64756C653E0042696756617269616E7446726F6D584D4C0042696756617269616E7446726F6D564152434841520042696756617269616E7446726F6D53514C5F56415249414E540053797374656D2E44617461006D73636F726C6962003C56616C75653E6B5F5F4261636B696E674669656C64003C49734E756C6C3E6B5F5F4261636B696E674669656C640047657448617368436F64650056616C756554797065005078746C43612E53716C436F6C6C656374696F6E732E436F726500506172736500446562756767657242726F777361626C65537461746500436F6D70696C657247656E65726174656441747472696275746500477569644174747269627574650044656275676761626C6541747472696275746500446562756767657242726F777361626C6541747472696275746500436F6D56697369626C6541747472696275746500417373656D626C795469746C654174747269627574650053716C55736572446566696E65645479706541747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C7946696C6556657273696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E4174747269627574650053716C46756E6374696F6E41747472696275746500417373656D626C794465736372697074696F6E41747472696275746500436F6D70696C6174696F6E52656C61786174696F6E7341747472696275746500416C6C6F775061727469616C6C795472757374656443616C6C65727341747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C79436F6D70616E794174747269627574650052756E74696D65436F6D7061746962696C697479417474726962757465006765745F56616C75650076616C75650053716C537472696E6700546F537472696E67006F626A005078746C43612E53716C436F6C6C656374696F6E732E436F72652E646C6C0044424E756C6C006765745F4E756C6C006765745F49734E756C6C0053716C586D6C0053797374656D0053797374656D2E5265666C656374696F6E004D6963726F736F66742E53716C5365727665722E536572766572002E63746F720053797374656D2E446961676E6F73746963730053797374656D2E52756E74696D652E496E7465726F7053657276696365730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300446562756767696E674D6F6465730053797374656D2E446174612E53716C547970657300457175616C7300466F726D6174004F626A6563740055736572446566696E656446756E6374696F6E735F42696756617269616E740053797374656D2E53656375726974790000094E0055004C004C0000000768ADCE19F33F4F8D9111F448F1916300042001010803200001052001011111042001010E04200101020520010111410520010111510306126906070211081108040702020E0320000E0707040202021108042001021C0307010803200008040701110808B77A5C561934E08902061C020602042001011C0320001C03200002040000110805000111081C06000111081261060001110811650328001C0328000204080011080801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F7773010801000701000000001F01001A5078746C43612E53716C436F6C6C656374696F6E732E436F7265000005010000000017010012436F7079726967687420C2A920203230313600002901002436303334336138362D323061392D346137342D626237662D66623361343630333163343000000C010007312E302E302E30000004010000000801000000000000000801000100000000000000000000B797005700000000020000001C010000482B0000480D000052534453069D49B1DEE633409F39128CFA20525901000000433A5C55736572735C4D617274696E5C44726F70626F785C50726F6A656374735C4769744875625C53716C436F6C6C656374696F6E735C5078746C43612E53716C436F6C6C656374696F6E732E436F72655C6F626A5C44656275675C5078746C43612E53716C436F6C6C656374696F6E732E436F72652E7064620000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008C2C00000000000000000000A62C0000002000000000000000000000000000000000000000000000982C0000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF250020001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058400000AC0300000000000000000000AC0334000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000001000000000000000100000000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B0040C030000010053007400720069006E006700460069006C00650049006E0066006F000000E802000001003000300030003000300034006200300000001A000100010043006F006D006D0065006E007400730000000000000022000100010043006F006D00700061006E0079004E0061006D00650000000000000000005E001B000100460069006C0065004400650073006300720069007000740069006F006E00000000005000780074006C00430061002E00530071006C0043006F006C006C0065006300740069006F006E0073002E0043006F007200650000000000300008000100460069006C006500560065007200730069006F006E000000000031002E0030002E0030002E00300000005E001F00010049006E007400650072006E0061006C004E0061006D00650000005000780074006C00430061002E00530071006C0043006F006C006C0065006300740069006F006E0073002E0043006F00720065002E0064006C006C00000000004800120001004C006500670061006C0043006F007000790072006900670068007400000043006F0070007900720069006700680074002000A90020002000320030003100360000002A00010001004C006500670061006C00540072006100640065006D00610072006B007300000000000000000066001F0001004F0072006900670069006E0061006C00460069006C0065006E0061006D00650000005000780074006C00430061002E00530071006C0043006F006C006C0065006300740069006F006E0073002E0043006F00720065002E0064006C006C000000000056001B000100500072006F0064007500630074004E0061006D006500000000005000780074006C00430061002E00530071006C0043006F006C006C0065006300740069006F006E0073002E0043006F007200650000000000340008000100500072006F006400750063007400560065007200730069006F006E00000031002E0030002E0030002E003000000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000031002E0030002E0030002E003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C000000B83C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000;


GO
PRINT N'Creating [dbo].[BigVariant]...';


GO
CREATE TYPE [dbo].[BigVariant]
     EXTERNAL NAME [PxtlCa.SqlCollections.Core].[PxtlCa.SqlCollections.Core.BigVariant];


GO
PRINT N'Creating [dbo].[BigVariantFromSQL_VARIANT]...';


GO
CREATE FUNCTION [dbo].[BigVariantFromSQL_VARIANT]
(@value XML)
RETURNS [dbo].[BigVariant]
AS
 EXTERNAL NAME [PxtlCa.SqlCollections.Core].[PxtlCa.SqlCollections.Core.UserDefinedFunctions_BigVariant].[BigVariantFromSQL_VARIANT]


GO
PRINT N'Creating [dbo].[BigVariantFromVARCHAR]...';


GO
CREATE FUNCTION [dbo].[BigVariantFromVARCHAR]
(@value NVARCHAR (MAX))
RETURNS [dbo].[BigVariant]
AS
 EXTERNAL NAME [PxtlCa.SqlCollections.Core].[PxtlCa.SqlCollections.Core.UserDefinedFunctions_BigVariant].[BigVariantFromVARCHAR]


GO
PRINT N'Creating [dbo].[BigVariantFromXML]...';


GO
CREATE FUNCTION [dbo].[BigVariantFromXML]
(@value XML)
RETURNS [dbo].[BigVariant]
AS
 EXTERNAL NAME [PxtlCa.SqlCollections.Core].[PxtlCa.SqlCollections.Core.UserDefinedFunctions_BigVariant].[BigVariantFromXML]


GO
DECLARE @VarDecimalSupported AS BIT;

SELECT @VarDecimalSupported = 0;

IF ((ServerProperty(N'EngineEdition') = 3)
    AND (((@@microsoftversion / power(2, 24) = 9)
          AND (@@microsoftversion & 0xffff >= 3024))
         OR ((@@microsoftversion / power(2, 24) = 10)
             AND (@@microsoftversion & 0xffff >= 1600))))
    SELECT @VarDecimalSupported = 1;

IF (@VarDecimalSupported > 0)
    BEGIN
        EXECUTE sp_db_vardecimal_storage_format N'$(DatabaseName)', 'ON';
    END


GO
PRINT N'Update complete.';


GO
